<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K√®o Th∆°m - Giao di·ªán Web (M√¥ ph·ªèng)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .sidebar-link.active {
            background-color: #F0FDFA;
            color: #14B8A6;
            font-weight: 600;
        }
        .filter-btn.active {
            background-color: #14B8A6;
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        .gemini-btn { background-color: #f0fdfa; color: #0d9488; border: 1px solid #ccfbf1; }
        .gemini-btn:hover { background-color: #ccfbf1; }
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #14B8A6; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #map-placeholder { width: 100%; height: 100%; }
        .profile-tab.active { border-bottom-color: #14B8A6; color: #14B8A6; font-weight: 600; }
        .my-keos-tab.active { border-bottom-color: #14B8A6; color: #14B8A6; font-weight: 600; }
        .lang-btn { background-color: #e2e8f0; color: #475569; padding: 0.25rem 0.75rem; border-radius: 0.5rem; font-weight: 600; transition: all 0.2s ease; cursor: pointer; }
        .lang-btn.active { background-color: #14B8A6; color: white; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06); }
        .error-message { color: #dc2626; font-size: 0.875rem; margin-top: 0.5rem; display: none; }
        
        .reel-card {
            height: 500px;
            background-color: #000;
            border-radius: 0.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .reel-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0));
            color: white;
        }
        .sos-card {
            border-left: 4px solid #ef4444; /* Red border for urgency */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Language Switcher -->
    <div class="fixed top-4 right-4 z-[60]">
        <div class="flex space-x-1 bg-gray-200 p-1 rounded-lg">
            <button id="lang-vi" class="lang-btn">VI</button>
            <button id="lang-en" class="lang-btn">EN</button>
        </div>
    </div>

    <!-- Auth Screens Container -->
    <div id="auth-container">
        <!-- Login Screen -->
        <div id="login-screen" class="fixed inset-0 bg-gray-100 flex items-center justify-center z-50">
            <div class="w-full max-w-sm p-8 bg-white rounded-2xl shadow-lg">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-extrabold text-teal-600">K√®o Th∆°m</h1>
                    <p class="text-sm text-gray-500 mt-1" data-translate-key="login_prompt">ƒêƒÉng nh·∫≠p ƒë·ªÉ b·∫Øt ƒë·∫ßu k·∫øt n·ªëi!</p>
                </div>
                <div class="space-y-4">
                     <div>
                        <label for="login-email" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="login_email">Email</label>
                        <input id="login-email" type="email" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 py-2 px-3" placeholder="email@daihoc.edu.vn">
                    </div>
                     <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="login_password">M·∫≠t kh·∫©u</label>
                        <input id="login-password" type="password" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500 py-2 px-3" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                </div>
                <p id="login-error-msg" class="error-message"></p>
                <div class="mt-4 flex items-center">
                    <input id="terms-checkbox" type="checkbox" class="h-4 w-4 text-teal-600 focus:ring-teal-500 border-gray-300 rounded">
                    <label for="terms-checkbox" class="ml-2 block text-sm text-gray-700" data-translate-key="login_terms">T√¥i ƒë·ªìng √Ω v·ªõi <a href="#" class="font-medium text-teal-600 hover:underline">ƒêi·ªÅu kho·∫£n</a> v√† <a href="#" class="font-medium text-teal-600 hover:underline">Ch√≠nh s√°ch</a></label>
                </div>
                <div class="mt-6">
                    <button id="login-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed" data-translate-key="login_button" disabled>
                        ƒêƒÉng nh·∫≠p
                    </button>
                </div>
                <div class="mt-6 text-center text-sm text-gray-500">
                    <p data-translate-key="login_with">ho·∫∑c ƒëƒÉng nh·∫≠p v·ªõi</p>
                    <div class="flex justify-center space-x-4 mt-2">
                        <button class="p-2 border rounded-full hover:bg-gray-100"><svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="currentColor" d="M21.35,11.1H12.18V13.83H18.69C18.36,17.64 15.19,19.27 12.19,19.27C8.36,19.27 5,16.25 5,12C5,7.75 8.36,4.73 12.19,4.73C14.03,4.73 15.1,5.5 15.71,6.09L17.9,3.9C16.21,2.56 14.2,2 12.19,2C6.42,2 2.03,6.8 2.03,12C2.03,17.2 6.42,22 12.19,22C17.6,22 21.7,18.35 21.7,12.38C21.7,11.63 21.55,11.37 21.35,11.1Z"></path></svg></button>
                        <button class="p-2 border rounded-full hover:bg-gray-100"><svg class="w-5 h-5 text-blue-600" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2.04C6.5 2.04 2 6.53 2 12.06C2 17.06 5.66 21.21 10.44 21.96V14.96H7.9V12.06H10.44V9.85C10.44 7.32 11.93 5.96 14.22 5.96C15.31 5.96 16.45 6.15 16.45 6.15V8.62H15.19C13.95 8.62 13.56 9.39 13.56 10.18V12.06H16.34L15.89 14.96H13.56V21.96A10 10 0 0 0 22 12.06C22 6.53 17.5 2.04 12 2.04Z"></path></svg></button>
                    </div>
                </div>
                 <div class="mt-6 text-center text-sm">
                    <p class="text-gray-500" data-translate-key="login_signup_prompt">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="#" id="signup-link" class="font-medium text-teal-600 hover:underline" data-translate-key="login_signup_link">ƒêƒÉng k√Ω ngay</a></p>
                </div>
            </div>
        </div>

        <!-- Signup Screen -->
        <div id="signup-screen" class="fixed inset-0 bg-gray-100 flex items-center justify-center z-50 hidden">
            <div class="w-full max-w-sm p-8 bg-white rounded-2xl shadow-lg">
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-extrabold text-teal-600" data-translate-key="signup_title">T·∫°o t√†i kho·∫£n</h1>
                    <p class="text-sm text-gray-500 mt-1" data-translate-key="signup_subtitle">Tham gia c·ªông ƒë·ªìng K√®o Th∆°m!</p>
                </div>
                <div class="space-y-4">
                     <div>
                        <label for="signup-name" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="signup_name">H·ªç v√† T√™n</label>
                        <input id="signup-name" type="text" class="block w-full border-gray-300 rounded-md shadow-sm py-2 px-3" placeholder="Nguy·ªÖn VƒÉn A">
                    </div>
                     <div>
                        <label for="signup-email" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="signup_email">Email</label>
                        <input id="signup-email" type="email" class="block w-full border-gray-300 rounded-md shadow-sm py-2 px-3" placeholder="email@daihoc.edu.vn">
                    </div>
                     <div>
                        <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="signup_password">M·∫≠t kh·∫©u</label>
                        <input id="signup-password" type="password" class="block w-full border-gray-300 rounded-md shadow-sm py-2 px-3" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                </div>
                <p id="signup-error-msg" class="error-message"></p>
                <div class="mt-6">
                    <button id="signup-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700" data-translate-key="signup_button">
                        ƒêƒÉng k√Ω
                    </button>
                </div>
                <div class="mt-6 text-center text-sm">
                    <p class="text-gray-500" data-translate-key="signup_login_prompt">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" id="back-to-login-link" class="font-medium text-teal-600 hover:underline" data-translate-key="signup_login_link">ƒêƒÉng nh·∫≠p</a></p>
                </div>
            </div>
        </div>

        <!-- Verification Screen -->
        <div id="verification-screen" class="fixed inset-0 bg-gray-100 flex items-center justify-center z-50 hidden">
            <div class="w-full max-w-sm p-8 bg-white rounded-2xl shadow-lg text-center">
                <h1 class="text-2xl font-bold text-teal-600" data-translate-key="verify_title">X√°c minh danh t√≠nh</h1>
                <p class="text-sm text-gray-500 mt-2 mb-6" data-translate-key="verify_subtitle">ƒê·ªÉ ƒë·∫£m b·∫£o an to√†n, vui l√≤ng t·∫£i l√™n ·∫£nh m·∫∑t tr∆∞·ªõc CCCD c·ªßa b·∫°n.</p>
                <div class="mt-6">
                    <label for="cccd-upload" class="cursor-pointer bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-10 flex flex-col items-center justify-center hover:bg-gray-200">
                        <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        <p id="upload-text" class="mt-2 text-sm text-gray-600" data-translate-key="verify_front">Nh·∫•n ƒë·ªÉ t·∫£i ·∫£nh l√™n</p>
                    </label>
                    <input id="cccd-upload" type="file" class="hidden" accept="image/*">
                </div>
                <div class="mt-6">
                    <button id="submit-verification-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700 disabled:bg-gray-300 disabled:cursor-not-allowed" data-translate-key="verify_button" disabled>
                        Ho√†n t·∫•t & B·∫Øt ƒë·∫ßu
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Main App Wrapper -->
    <div id="main-app" class="flex h-screen overflow-hidden hidden">
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r border-gray-200 flex flex-col">
            <div class="px-6 py-4 border-b border-gray-200">
                <h1 class="text-3xl font-extrabold text-teal-600">K√®o Th∆°m</h1>
                <p class="text-xs text-gray-500" data-translate-key="tagline">K·∫øt n·ªëi t·ª©c th·ªùi, G·∫Øn k·∫øt c·ªông ƒë·ªìng.</p>
            </div>
            <nav class="flex-1 px-4 py-4 space-y-2 overflow-y-auto">
                <a href="#home" class="sidebar-link flex items-center px-4 py-2 text-gray-700 rounded-lg active" data-view="home">
                    <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    <span data-translate-key="nav_home">T√¨m K√®o</span>
                </a>
                <a href="#reels" class="sidebar-link flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100" data-view="reels">
                    <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span data-translate-key="nav_reels">K√®o Reels</span>
                </a>
                 <a href="#marketplace" class="sidebar-link flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100" data-view="marketplace">
                     <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    <span data-translate-key="nav_marketplace">Marketplace</span>
                 </a>
                 <a href="#coupons" class="sidebar-link flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100" data-view="coupons">
                    <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"></path></svg>
                    <span data-translate-key="nav_coupons">Coupon Hub</span>
                 </a>
                 <a href="#challenges" class="sidebar-link flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100" data-view="challenges">
                     <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    <span data-translate-key="nav_challenges">Th·ª≠ th√°ch & BXH</span>
                 </a>
                 <a href="#qna" class="sidebar-link flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100" data-view="qna">
                     <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span data-translate-key="nav_qna">H·ªèi Nhanh</span>
                 </a>
                 <a href="#sos" class="sidebar-link flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100" data-view="sos">
                    <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    <span data-translate-key="nav_sos">SOS K√®o</span>
                 </a>
                <a href="#mykeos" class="sidebar-link flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100" data-view="mykeos">
                    <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    <span data-translate-key="nav_my_keos">K√®o c·ªßa t√¥i</span>
                </a>
                <a href="#notifications" class="sidebar-link flex items-center px-4 py-2 text-gray-700 rounded-lg hover:bg-gray-100" data-view="notifications">
                     <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                    <span data-translate-key="nav_notifications">Th√¥ng b√°o</span>
                </a>
            </nav>
            <div class="px-6 py-4 border-t border-gray-200">
                <button id="create-keo-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700 transition-colors flex items-center justify-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
                    <span data-translate-key="create_keo_button">T·∫°o K√®o M·ªõi</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <header class="bg-white border-b border-gray-200 p-4 flex justify-between items-center">
                <div class="relative w-full max-w-md">
                    <input type="text" class="w-full bg-gray-100 border border-gray-200 rounded-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-teal-500" data-translate-key="search_placeholder" placeholder="T√¨m ki·∫øm k√®o...">
                    <svg class="w-5 h-5 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
                <div id="profile-btn" class="flex items-center space-x-4 cursor-pointer">
                    <img id="profile-header-avatar" class="w-10 h-10 rounded-full" src="https://placehold.co/100x100/A7F3D0/134E4A?text=MA" alt="User avatar">
                    <span id="profile-header-name" class="font-semibold">Minh Anh</span>
                </div>
            </header>
            
            <div class="flex-1 flex overflow-hidden">
                <!-- Main Content Area - Switches based on sidebar selection -->
                <div id="main-content-area" class="flex-1 flex overflow-hidden">
                    <!-- Home View (Default) -->
                    <div id="view-home" class="flex-1 flex overflow-hidden view-content">
                        <!-- K√®o Feed -->
                        <section class="flex-1 overflow-y-auto p-6">
                            <div class="mb-6">
                                <h2 class="text-2xl font-bold mb-4" data-translate-key="feed_title">K√®o N·ªïi B·∫≠t Quanh ƒê√¢y</h2>
                                <div id="filters" class="flex flex-wrap gap-2">
                                    <button class="filter-btn active px-4 py-1.5 text-sm font-semibold rounded-full bg-gray-200 hover:bg-gray-300 transition-colors" data-filter="all" data-translate-key="filter_all">T·∫•t c·∫£</button>
                                    <button class="filter-btn px-4 py-1.5 text-sm font-semibold rounded-full bg-gray-200 hover:bg-gray-300 transition-colors" data-filter="ƒÇn u·ªëng" data-translate-key="filter_eating">üçî ƒÇn u·ªëng</button>
                                    <button class="filter-btn px-4 py-1.5 text-sm font-semibold rounded-full bg-gray-200 hover:bg-gray-300 transition-colors" data-filter="Th·ªÉ thao" data-translate-key="filter_sports">‚öΩÔ∏è Th·ªÉ thao</button>
                                    <button class="filter-btn px-4 py-1.5 text-sm font-semibold rounded-full bg-gray-200 hover:bg-gray-300 transition-colors" data-filter="H·ªçc t·∫≠p" data-translate-key="filter_study">üìö H·ªçc t·∫≠p</button>
                                    <button class="filter-btn px-4 py-1.5 text-sm font-semibold rounded-full bg-gray-200 hover:bg-gray-300 transition-colors" data-filter="Gi·∫£i tr√≠" data-translate-key="filter_fun">üé¨ Gi·∫£i tr√≠</button>
                                </div>
                            </div>
                            <div id="keo-feed" class="space-y-4">
                                <!-- K√®o cards dynamically generated -->
                            </div>
                        </section>
                        
                        <!-- Map & Details -->
                        <aside class="w-1/3 bg-white border-l border-gray-200 p-6 flex-col hidden lg:flex">
                             <h3 class="text-xl font-bold mb-4" data-translate-key="map_title">B·∫£n ƒë·ªì K√®o</h3>
                             <div class="relative w-full h-64 bg-gray-100 rounded-lg overflow-hidden mb-6 border">
                                <div id="map-placeholder" class="bg-gray-200 flex items-center justify-center h-full">
                                    <p class="text-gray-500" data-translate-key="map_placeholder">B·∫£n ƒë·ªì Google Maps (ƒë√£ t·∫Øt)</p>
                                </div>
                                <button title="Toggle Heatmap" class="absolute top-2 right-2 bg-white p-1.5 rounded shadow text-gray-600 hover:bg-gray-100">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343m11.314 11.314a8 8 0 00-11.314-11.314m11.314 11.314L6.343 7.343"></path></svg>
                                </button>
                             </div>
                             <div id="keo-details" class="flex-1 overflow-y-auto">
                                <div class="text-center text-gray-500 pt-10">
                                    <p class="text-lg font-semibold" data-translate-key="details_prompt_title">Ch·ªçn m·ªôt k√®o ƒë·ªÉ xem chi ti·∫øt</p>
                                    <p class="text-sm" data-translate-key="details_prompt_subtitle">Th√¥ng tin v·ªÅ ƒë·ªãa ƒëi·ªÉm, th·ªùi gian v√† ng∆∞·ªùi tham gia s·∫Ω hi·ªán ·ªü ƒë√¢y.</p>
                                </div>
                             </div>
                        </aside>
                    </div>

                    <!-- Placeholder Views for New Features -->
                    <div id="view-reels" class="flex-1 p-6 overflow-y-auto view-content hidden">
                        <h2 class="text-2xl font-bold mb-4" data-translate-key="nav_reels">K√®o Reels</h2>
                        <!-- Reels UI Mockup -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="reel-card">
                                <img src="https://placehold.co/300x500/FCA5A5/450A0A?text=K√®o+ƒÉn+s·∫≠p+K√Ω+t√∫c+x√°" class="w-full h-full object-cover">
                                <div class="reel-overlay">
                                    <p class="font-semibold">@an_nguyen</p>
                                    <p class="text-sm truncate">K√®o ƒÉn s·∫≠p K√Ω t√∫c x√°! üçú</p>
                                </div>
                            </div>
                             <div class="reel-card">
                                <img src="https://placehold.co/300x500/818CF8/1E1B4B?text=Giao+l∆∞u+guitar" class="w-full h-full object-cover">
                                <div class="reel-overlay">
                                    <p class="font-semibold">@linh_music</p>
                                    <p class="text-sm truncate">Giao l∆∞u guitar t·∫°i s√¢n C1 üé∏</p>
                                </div>
                            </div>
                             <div class="reel-card">
                                <img src="https://placehold.co/300x500/FCD34D/78350F?text=Th·ª≠+th√°ch+ƒë√°+c·∫ßu" class="w-full h-full object-cover">
                                <div class="reel-overlay">
                                    <p class="font-semibold">@hung_thethao</p>
                                    <p class="text-sm truncate">Th·ª≠ th√°ch ƒë√° c·∫ßu cu·ªëi tu·∫ßn</p>
                                </div>
                            </div>
                        </div>
                    </div>
                     <div id="view-marketplace" class="flex-1 p-6 overflow-y-auto view-content hidden">
                        <h2 class="text-2xl font-bold mb-4" data-translate-key="nav_marketplace">Marketplace (Ch·ª£ K√®o)</h2>
                        
                        <!-- Marketplace UI -->
                        <div class="mb-4">
                            <input type="text" class="w-full bg-white border border-gray-300 rounded-full py-2 px-4 focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="T√¨m ki·∫øm trong Marketplace... (VD: S√°ch Gi·∫£i t√≠ch 1)">
                        </div>
                        <div class="flex flex-wrap gap-2 mb-6">
                            <button class="filter-btn active px-4 py-1.5 text-sm font-semibold rounded-full bg-gray-200 hover:bg-gray-300 transition-colors" data-filter="all" data-translate-key="filter_all">T·∫•t c·∫£</button>
                            <button class="filter-btn px-4 py-1.5 text-sm font-semibold rounded-full bg-gray-200 hover:bg-gray-300 transition-colors" data-filter="books">üìö S√°ch/T√†i li·ªáu</button>
                            <button class="filter-btn px-4 py-1.5 text-sm font-semibold rounded-full bg-gray-200 hover:bg-gray-300 transition-colors" data-filter="electronics">üì± ƒê·ªì ƒëi·ªán t·ª≠</button>
                            <button class="filter-btn px-4 py-1.5 text-sm font-semibold rounded-full bg-gray-200 hover:bg-gray-300 transition-colors" data-filter="furniture">üõãÔ∏è ƒê·ªì d√πng</button>
                        </div>

                        <!-- Marketplace Item Grid -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <!-- Item Card 1 -->
                            <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden">
                                <img src="https://placehold.co/600x400/E0F2F1/00796B?text=S√°ch+Gi·∫£i+t√≠ch" alt="S√°ch Gi·∫£i t√≠ch 1" class="h-48 w-full object-cover">
                                <div class="p-4">
                                    <h3 class="font-bold text-lg">S√°ch Gi·∫£i t√≠ch 1 (c√≤n m·ªõi 99%)</h3>
                                    <p class="text-teal-600 font-bold text-xl mt-2">70.000 VNƒê</p>
                                    <p class="text-sm text-gray-500 mt-1">Ng∆∞·ªùi b√°n: An Nguy·ªÖn (KTX M·ªÖ Tr√¨)</p>
                                </div>
                            </div>
                            <!-- Item Card 2 -->
                            <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden">
                                <img src="https://placehold.co/600x400/FFF3E0/E65100?text=Tai+nghe" alt="Tai nghe Bluetooth" class="h-48 w-full object-cover">
                                <div class="p-4">
                                    <h3 class="font-bold text-lg">Pass tai nghe Bluetooth Sony</h3>
                                    <p class="text-teal-600 font-bold text-xl mt-2">350.000 VNƒê</p>
                                    <p class="text-sm text-gray-500 mt-1">Ng∆∞·ªùi b√°n: H√πng L√™ (B√°ch Khoa)</p>
                                </div>
                            </div>
                            <!-- Item Card 3 -->
                            <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden">
                                <img src="https://placehold.co/600x400/E3F2FD/0D47A1?text=Qu·∫°t+b√†n" alt="Qu·∫°t b√†n" class="h-48 w-full object-cover">
                                <div class="p-4">
                                    <h3 class="font-bold text-lg">Thanh l√Ω qu·∫°t b√†n Senko</h3>
                                    <p class="text-teal-600 font-bold text-xl mt-2">100.000 VNƒê</p>
                                    <p class="text-sm text-gray-500 mt-1">Ng∆∞·ªùi b√°n: Trang Tr·∫ßn (KTX Ngo·∫°i Ng·ªØ)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                     <div id="view-coupons" class="flex-1 p-6 overflow-y-auto view-content hidden">
                        <h2 class="text-2xl font-bold mb-4" data-translate-key="nav_coupons">Coupon Hub</h2>
                        <!-- Coupon UI Mockup -->
                        <div class="space-y-4">
                            <div class="bg-white p-4 rounded-lg shadow border border-gray-200 flex items-center justify-between">
                                <div class="flex items-center">
                                    <img src="https://placehold.co/100x100/FEE2E2/B91C1C?text=Toco" class="w-16 h-16 rounded-lg mr-4">
                                    <div>
                                        <h3 class="font-bold text-lg">Gi·∫£m 20% TocoToco</h3>
                                        <p class="text-sm text-gray-500">√Åp d·ª•ng cho K√®o ƒëi t·ª´ 2 ng∆∞·ªùi. H·∫øt h·∫°n: 30/11</p>
                                    </div>
                                </div>
                                <button class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg text-sm">L·∫•y m√£</button>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow border border-gray-200 flex items-center justify-between">
                                <div class="flex items-center">
                                    <img src="https://placehold.co/100x100/E0E7FF/312E81?text=CGV" class="w-16 h-16 rounded-lg mr-4">
                                    <div>
                                        <h3 class="font-bold text-lg">Mua 1 t·∫∑ng 1 v√© CGV</h3>
                                        <p class="text-sm text-gray-500">Cho K√®o "Gi·∫£i tr√≠" v√†o th·ª© 3. H·∫øt h·∫°n: 25/11</p>
                                    </div>
                                </div>
                                <button class="bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-lg text-sm">L·∫•y m√£</button>
                            </div>
                        </div>
                    </div>
                     <div id="view-challenges" class="flex-1 p-6 overflow-y-auto view-content hidden">
                        <h2 class="text-2xl font-bold mb-4" data-translate-key="nav_challenges">Th·ª≠ th√°ch & BXH</h2>
                        
                        <!-- Gemini Challenge Generator -->
                        <div class="mb-6">
                            <button id="gemini-challenge-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700 transition-colors flex items-center justify-center space-x-2">
                                <span data-translate-key="challenge_suggest_btn">‚ú® G·ª£i √Ω Th·ª≠ th√°ch Tu·∫ßn m·ªõi</span>
                                <div id="challenge-loader" class="loader hidden"></div>
                            </button>
                        </div>
                        <div id="challenge-suggestion-box" class="bg-white p-6 rounded-lg shadow border border-gray-200 hidden mb-6">
                            <h3 class="text-lg font-semibold text-teal-700" data-translate-key="challenge_idea_title">√ù t∆∞·ªüng Th·ª≠ th√°ch:</h3>
                            <p id="challenge-suggestion-text" class="mt-2 text-gray-700"></p>
                        </div>

                        <!-- Leaderboard Mockup -->
                        <h3 class="text-xl font-bold mb-4">B·∫£ng X·∫øp H·∫°ng KTX M·ªÖ Tr√¨</h3>
                        <div class="bg-white rounded-lg shadow border border-gray-200 divide-y divide-gray-200">
                            <div class="p-4 flex items-center space-x-4">
                                <span class="font-bold text-lg">1.</span>
                                <img src="https://placehold.co/100x100/FEF3C7/92400E?text=HV" class="w-10 h-10 rounded-full">
                                <span class="font-semibold">H√πng V≈©</span>
                                <span class="ml-auto font-bold text-teal-600">1500 XP</span>
                            </div>
                            <div class="p-4 flex items-center space-x-4">
                                <span class="font-bold text-lg">2.</span>
                                <img src="https://placehold.co/100x100/D1FAE5/064E3B?text=LT" class="w-10 h-10 rounded-full">
                                <span class="font-semibold">Linh Trang</span>
                                <span class="ml-auto font-bold text-teal-600">1350 XP</span>
                            </div>
                            <div class="p-4 flex items-center space-x-4">
                                <span class="font-bold text-lg">3.</span>
                                <img src="https://placehold.co/100x100/DBEAFE/1E3A8A?text=QA" class="w-10 h-10 rounded-full">
                                <span class="font-semibold">Qu√¢n Anh</span>
                                <span class="ml-auto font-bold text-teal-600">1200 XP</span>
                            </div>
                        </div>
                    </div>
                     <div id="view-qna" class="flex-1 p-6 overflow-y-auto view-content hidden">
                        <h2 class="text-2xl font-bold mb-4" data-translate-key="nav_qna">H·ªèi Nhanh</h2>
                        <!-- Q&A Mockup -->
                        <div class="mb-4">
                            <textarea class="w-full bg-white border border-gray-300 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-teal-500" rows="3" placeholder="ƒê·∫∑t c√¢u h·ªèi ·∫©n danh cho c·ªông ƒë·ªìng KTX... (VD: CƒÉng tin c√≤n m·ªü c·ª≠a kh√¥ng?)"></textarea>
                            <button class="mt-2 bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-700">ƒêƒÉng c√¢u h·ªèi</button>
                        </div>
                        <div class="space-y-4">
                            <div class="bg-white p-4 rounded-lg shadow border border-gray-200">
                                <p class="font-semibold">Th∆∞ vi·ªán T·∫° Quang B·ª≠u t·ªëi nay c√≥ ƒë√¥ng kh√¥ng m·ªçi ng∆∞·ªùi?</p>
                                <p class="text-sm text-gray-500 mt-2">5 ph√∫t tr∆∞·ªõc - ·∫®n danh</p>
                                <button class="text-sm text-teal-600 font-semibold mt-2">2 c√¢u tr·∫£ l·ªùi...</button>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow border border-gray-200">
                                <p class="font-semibold">Ai ·ªü KTX M·ªÖ Tr√¨ cho m∆∞·ª£n s·∫°c iPhone 10 ph√∫t v·ªõi ·∫°! M√¨nh ·ªü P301.</p>
                                <p class="text-sm text-gray-500 mt-2">12 ph√∫t tr∆∞·ªõc - @minh_anh</p>
                                <button class="text-sm text-teal-600 font-semibold mt-2">Tr·∫£ l·ªùi</button>
                            </div>
                        </div>
                    </div>
                     <div id="view-sos" class="flex-1 p-6 overflow-y-auto view-content hidden">
                        <h2 class="text-2xl font-bold mb-4" data-translate-key="nav_sos">SOS K√®o</h2>
                        <!-- SOS Mockup -->
                        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-6" role="alert">
                            <strong class="font-bold">C·∫£nh b√°o!</strong>
                            <span class="block sm:inline">Ch·ªâ d√πng t√≠nh nƒÉng n√†y cho c√°c y√™u c·∫ßu tr·ª£ gi√∫p nh·ªè, kh·∫©n c·∫•p, phi t√†i ch√≠nh. L·∫°m d·ª•ng c√≥ th·ªÉ b·ªã kh√≥a t√†i kho·∫£n.</span>
                        </div>
                        <button class="w-full bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors">T·∫°o Y√™u c·∫ßu SOS M·ªõi</button>
                         <div class="mt-6 space-y-4">
                            <div class="bg-white p-4 rounded-lg shadow border border-gray-200 sos-card">
                                <h3 class="font-bold text-lg text-red-600">H·∫æT XƒÇNG</h3>
                                <p class="text-gray-700 mt-1">Xe m√¨nh h·∫øt xƒÉng ·ªü g·∫ßn c·ªïng Parabol ƒêHQG, ai ti·ªán ƒëi qua gi√∫p ƒë·∫©y m·ªôt ƒëo·∫°n v·ªõi ·∫°!</p>
                                <!-- S·ª¨A L·ªñI: </V> -> </p> -->
                                <p class="text-sm text-gray-500 mt-2">5 ph√∫t tr∆∞·ªõc - @hoang_nam</p>
                                <button class="mt-3 bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg text-sm">T√¥i c√≥ th·ªÉ gi√∫p</button>
                            </div>
                         </div>
                    </div>
                     <div id="view-mykeos" class="flex-1 p-6 overflow-y-auto view-content hidden">
                        <h2 class="text-2xl font-bold mb-4" data-translate-key="nav_my_keos">K√®o c·ªßa t√¥i</h2>
                        
                        <!-- NEW: My Keos UI -->
                        <div class="border-b border-gray-200 mb-4">
                            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                                <button class="my-keos-tab active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="my-created" data-translate-key="my_keos_created_title">K√®o t√¥i t·∫°o</button>
                                <button class="my-keos-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="my-joined" data-translate-key="my_keos_joined_title">K√®o t√¥i tham gia</button>
                            </nav>
                        </div>
                        
                        <div id="my-created-keos-list" class="space-y-4 my-keos-tab-content">
                            <!-- Dynamically populated -->
                        </div>
                         <div id="my-joined-keos-list" class="space-y-4 my-keos-tab-content hidden">
                            <!-- Dynamically populated -->
                        </div>

                    </div>
                     <div id="view-notifications" class="flex-1 p-6 overflow-y-auto view-content hidden">
                        <h2 class="text-2xl font-bold mb-4" data-translate-key="nav_notifications">Th√¥ng b√°o</h2>
                        <p class="text-gray-500" data-translate-key="coming_soon">T√≠nh nƒÉng s·∫Øp ra m·∫Øt! T·∫•t c·∫£ c·∫≠p nh·∫≠t v·ªÅ k√®o s·∫Ω ·ªü ƒë√¢y.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals Container -->
    <div id="modals-container">
        <!-- Create Keo Modal -->
        <div id="create-keo-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center hidden z-40">
            <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-lg">
                <h2 class="text-2xl font-bold mb-6" data-translate-key="modal_create_title">T·∫°o K√®o M·ªõi</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="modal_create_content">N·ªôi dung k√®o</label>
                        <div class="flex items-center space-x-2">
                            <input id="keo-title-input" type="text" class="flex-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500" placeholder="VD: T√¨m ng∆∞·ªùi ƒÉn tr∆∞a b√∫n ƒë·∫≠u...">
                            <button id="gemini-title-btn" class="gemini-btn font-semibold py-2 px-3 rounded-md flex items-center space-x-2 text-sm">
                                <span data-translate-key="modal_create_suggest">‚ú® G·ª£i √Ω</span>
                                <div id="title-loader" class="loader hidden"></div>
                            </button>
                        </div>
                        <div id="title-suggestions" class="mt-2 space-y-1"></div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="modal_create_category">Lo·∫°i k√®o</label>
                        <select id="keo-category-input" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500">
                            <option data-translate-key="category_eating">ƒÇn u·ªëng</option> 
                            <option data-translate-key="category_sports">Th·ªÉ thao</option> 
                            <option data-translate-key="category_study">H·ªçc t·∫≠p</option> 
                            <option data-translate-key="category_fun">Gi·∫£i tr√≠</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="modal_create_location">ƒê·ªãa ƒëi·ªÉm</label>
                        <input id="keo-location-input" type="text" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500" placeholder="VD: Qu√°n C√¢y B√†ng, Ch√πa L√°ng">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="modal_create_max_participants">S·ªë ng∆∞·ªùi t·ªëi ƒëa (g·ªìm b·∫°n)</label>
                        <input id="keo-max-input" type="number" min="2" value="5" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500">
                    </div>
                </div>
                <div class="mt-8 flex justify-end space-x-3">
                    <button class="close-modal-btn bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300" data-translate-key="modal_cancel">H·ªßy</button>
                    <button id="publish-keo-btn" class="bg-teal-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-teal-700" data-translate-key="modal_create_publish">ƒêƒÉng K√®o</button>
                </div>
            </div>
        </div>
        <!-- Profile Modal -->
        <div id="profile-modal" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center hidden z-40">
            <div class="bg-white rounded-lg shadow-xl p-8 w-full max-w-2xl">
                 <button class="close-modal-btn absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
                <div class="flex items-center space-x-6 mb-6">
                    <img id="profile-modal-avatar" class="w-24 h-24 rounded-full border-4 border-teal-500" src="https://placehold.co/100x100/A7F3D0/134E4A?text=MA" alt="User avatar">
                    <div>
                        <h2 id="profile-modal-name" class="text-3xl font-bold">Minh Anh</h2>
                        <p id="profile-modal-university" class="text-gray-500" data-translate-key="profile_university">Sinh vi√™n - ƒê·∫°i h·ªçc Qu·ªëc gia H√† N·ªôi</p>
                        <div id="profile-modal-tags" class="flex flex-wrap gap-2 mt-3">
                            <span class="text-xs font-semibold bg-blue-100 text-blue-800 px-2 py-1 rounded-full">#Badminton</span>
                            <span class="text-xs font-semibold bg-green-100 text-green-800 px-2 py-1 rounded-full">#CoffeeLover</span>
                            <span class="text-xs font-semibold bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full">#Photography</span>
                        </div>
                    </div>
                </div>

                <!-- NEW: Profile Bio Section -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1" data-translate-key="profile_bio">Gi·ªõi thi·ªáu ng·∫Øn</label>
                    <textarea id="profile-bio-input" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-teal-500 focus:border-teal-500" rows="2" placeholder="N√≥i g√¨ ƒë√≥ v·ªÅ b·∫°n..."></textarea>
                    <button id="gemini-bio-btn" class="gemini-btn font-semibold py-1 px-2 rounded-md flex items-center space-x-2 text-xs mt-2">
                        <span data-translate-key="profile_bio_suggest">‚ú® G·ª£i √Ω Bio (AI)</span>
                        <div id="bio-loader" class="loader hidden"></div>
                    </button>
                </div>
                
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                        <button class="profile-tab active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="created" data-translate-key="profile_tab_created">K√®o ƒë√£ t·∫°o</button>
                        <button class="profile-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="joined" data-translate-key="profile_tab_joined">K√®o ƒë√£ tham gia</button>
                        <button class="profile-tab whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="achievements" data-translate-key="nav_challenges">Th√†nh t√≠ch</button>
                    </nav>
                </div>

                <div id="tab-content-created" class="py-4 max-h-60 overflow-y-auto">
                   <p class="text-gray-500 text-center" data-translate-key="profile_no_created">Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o.</p>
                   <!-- Created Keos will be listed here -->
                </div>
                 <div id="tab-content-joined" class="py-4 max-h-60 overflow-y-auto hidden">
                   <p class="text-gray-500 text-center" data-translate-key="profile_no_joined">B·∫°n ch∆∞a tham gia k√®o n√†o.</p>
                   <!-- Joined Keos will be listed here -->
                </div>
                 <div id="tab-content-achievements" class="py-4 max-h-60 overflow-y-auto hidden">
                   <p class="text-gray-500 text-center" data-translate-key="coming_soon">T√≠nh nƒÉng s·∫Øp ra m·∫Øt! (VD: Huy hi·ªáu "K√®o Th·ªß", "Ma m·ªõi")</p>
                </div>


                <div class="mt-6 flex justify-end">
                    <button id="logout-btn" class="text-sm text-red-600 font-semibold hover:underline" data-translate-key="profile_logout">ƒêƒÉng xu·∫•t</button>
                </div>
            </div>
        </div>
    </div>

<script type="module">
    // ƒê√É X√ìA T√çCH H·ª¢P FIREBASE
    
    // B·ªåC T·∫§T C·∫¢ LOGIC B√äN TRONG DOMCONTENTLOADED
    document.addEventListener("DOMContentLoaded", () => {
    
        // --- Data ---
        let DUMMY_KEOS = [
          { id: '1', category: 'ƒÇn u·ªëng', title: 'T√¨m ng∆∞·ªùi ƒÉn tr∆∞a b√∫n ƒë·∫≠u C√¢y B√†ng', location: '1km - C√¢y B√†ng, Ch√πa L√°ng', time: 'C√≤n 30 ph√∫t', participants: ['An', 'Minh', 'Hoa'], maxParticipants: 4, avatar: 'üçî', lat: 21.025, lng: 105.800, creator: 'An'},
          { id: '2', category: 'Th·ªÉ thao', title: 'L·∫≠p team ƒë√° b√≥ng s√¢n C·∫ßu Gi·∫•y', location: '2.5km - S√¢n b√≥ng C·∫ßu Gi·∫•y', time: 'B·∫Øt ƒë·∫ßu l√∫c 17:00', participants: ['H√πng', 'S∆°n', 'ƒê·ª©c', 'Ki√™n', 'Long'], maxParticipants: 7, avatar: '‚öΩÔ∏è', lat: 21.030, lng: 105.790, creator: 'H√πng'},
          { id: '3', category: 'H·ªçc t·∫≠p', title: 'T√¨m b·∫°n h·ªçc nh√≥m m√¥n Tri·∫øt', location: '500m - Th∆∞ vi·ªán T·∫° Quang B·ª≠u', time: 'B√¢y gi·ªù', participants: ['Linh'], maxParticipants: 3, avatar: 'üìö', lat: 21.006, lng: 105.843, creator: 'Linh'},
          { id: '4', category: 'Gi·∫£i tr√≠', title: 'T√¨m 2 ng∆∞·ªùi xem phim Oppenheimer su·∫•t 8h', location: '3km - CGV Vincom NCT', time: 'C√≤n 2 gi·ªù', participants: ['Mai', 'T√∫'], maxParticipants: 4, avatar: 'üé¨', lat: 21.018, lng: 105.810, creator: 'Mai'},
          { id: '5', category: 'ƒÇn u·ªëng', title: 'ƒêi u·ªëng tr√† chanh Nh√† Th·ªù', location: '4km - Ph·ªë Nh√† Th·ªù', time: 'T·ªëi nay 8h', participants: ['Quang', 'Trang'], maxParticipants: 5, avatar: 'üçã', lat: 21.028, lng: 105.850, creator: 'Quang'},
        ];
        
        // --- User State ---
        let currentUser = null; // B·∫Øt ƒë·∫ßu l√† null (ch∆∞a ƒëƒÉng nh·∫≠p)
        let userCreatedKeos = [];
        let userJoinedKeos = [];

        // --- Translations Object ---
        const translations = {
            vi: {
                login_prompt: 'ƒêƒÉng nh·∫≠p ƒë·ªÉ b·∫Øt ƒë·∫ßu k·∫øt n·ªëi!',
                login_email: 'Email',
                login_password: 'M·∫≠t kh·∫©u',
                login_terms: 'T√¥i ƒë·ªìng √Ω v·ªõi ',
                login_terms_link: 'ƒêi·ªÅu kho·∫£n',
                login_policy_link: 'Ch√≠nh s√°ch',
                login_button: 'ƒêƒÉng nh·∫≠p',
                login_with: 'ho·∫∑c ƒëƒÉng nh·∫≠p v·ªõi',
                login_signup_prompt: 'Ch∆∞a c√≥ t√†i kho·∫£n? ',
                login_signup_link: 'ƒêƒÉng k√Ω ngay',
                signup_title: 'T·∫°o t√†i kho·∫£n',
                signup_subtitle: 'Tham gia c·ªông ƒë·ªìng K√®o Th∆°m!',
                signup_name: 'H·ªç v√† T√™n',
                signup_email: 'Email',
                signup_password: 'M·∫≠t kh·∫©u',
                signup_button: 'ƒêƒÉng k√Ω',
                signup_login_prompt: 'ƒê√£ c√≥ t√†i kho·∫£n? ',
                signup_login_link: 'ƒêƒÉng nh·∫≠p',
                verify_title: 'X√°c minh danh t√≠nh',
                verify_subtitle: 'ƒê·ªÉ ƒë·∫£m b·∫£o an to√†n, vui l√≤ng t·∫£i l√™n ·∫£nh m·∫∑t tr∆∞·ªõc CCCD c·ªßa b·∫°n.',
                verify_front: 'Nh·∫•n ƒë·ªÉ t·∫£i ·∫£nh l√™n',
                verify_button: 'Ho√†n t·∫•t & B·∫Øt ƒë·∫ßu',
                upload_status_uploaded: 'ƒê√£ t·∫£i l√™n ‚úì',
                tagline: 'K·∫øt n·ªëi t·ª©c th·ªùi, G·∫Øn k·∫øt c·ªông ƒë·ªìng.',
                nav_home: 'T√¨m K√®o',
                nav_reels: 'K√®o Reels',
                nav_marketplace: 'Marketplace',
                nav_coupons: 'Coupon Hub',
                nav_challenges: 'Th·ª≠ th√°ch & BXH',
                nav_qna: 'H·ªèi Nhanh',
                nav_sos: 'SOS K√®o',
                nav_my_keos: 'K√®o c·ªßa t√¥i',
                nav_notifications: 'Th√¥ng b√°o',
                create_keo_button: 'T·∫°o K√®o M·ªõi',
                search_placeholder: 'T√¨m ki·∫øm k√®o...',
                feed_title: 'K√®o N·ªïi B·∫≠t Quanh ƒê√¢y',
                filter_all: 'T·∫•t c·∫£',
                filter_eating: 'üçî ƒÇn u·ªëng',
                filter_sports: '‚öΩÔ∏è Th·ªÉ thao',
                filter_study: 'üìö H·ªçc t·∫≠p',
                filter_fun: 'üé¨ Gi·∫£i tr√≠',
                map_title: 'B·∫£n ƒë·ªì K√®o',
                map_placeholder: 'B·∫£n ƒë·ªì Google Maps (ƒë√£ t·∫Øt)',
                details_prompt_title: 'Ch·ªçn m·ªôt k√®o ƒë·ªÉ xem chi ti·∫øt',
                details_prompt_subtitle: 'Th√¥ng tin v·ªÅ ƒë·ªãa ƒëi·ªÉm, th·ªùi gian v√† ng∆∞·ªùi tham gia s·∫Ω hi·ªán ·ªü ƒë√¢y.',
                modal_create_title: 'T·∫°o K√®o M·ªõi',
                modal_create_content: 'N·ªôi dung k√®o',
                modal_create_suggest: '‚ú® G·ª£i √Ω',
                modal_create_category: 'Lo·∫°i k√®o',
                category_eating: 'ƒÇn u·ªëng',
                category_sports: 'Th·ªÉ thao',
                category_study: 'H·ªçc t·∫≠p',
                category_fun: 'Gi·∫£i tr√≠',
                modal_create_location: 'ƒê·ªãa ƒëi·ªÉm',
                modal_create_max_participants: 'S·ªë ng∆∞·ªùi t·ªëi ƒëa (g·ªìm b·∫°n)',
                modal_cancel: 'H·ªßy',
                modal_create_publish: 'ƒêƒÉng K√®o',
                alert_fill_fields: 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß n·ªôi dung v√† ƒë·ªãa ƒëi·ªÉm.',
                alert_fill_name: 'Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n.',
                alert_fill_email: 'Vui l√≤ng nh·∫≠p email.',
                alert_cancel_keo_confirm: 'B·∫°n c√≥ ch·∫Øc mu·ªën h·ªßy k√®o n√†y kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.',
                profile_university: 'Sinh vi√™n - ƒê·∫°i h·ªçc Qu·ªëc gia H√† N·ªôi',
                profile_tab_created: 'K√®o ƒë√£ t·∫°o',
                profile_tab_joined: 'K√®o ƒë√£ tham gia',
                my_keos_created_title: 'K√®o b·∫°n ƒë√£ t·∫°o',
                my_keos_joined_title: 'K√®o b·∫°n ƒë√£ tham gia',
                profile_no_created: 'Ch∆∞a c√≥ ho·∫°t ƒë·ªông n√†o.',
                profile_no_joined: 'B·∫°n ch∆∞a tham gia k√®o n√†o.',
                profile_logout: 'ƒêƒÉng xu·∫•t',
                details_participants_title: 'Nh·ªØng ng∆∞·ªùi s·∫Ω tham gia',
                details_join_button: 'Tham gia K√®o n√†y',
                details_leave_button: 'R·ªùi kh·ªèi K√®o',
                details_cancel_button: 'H·ªßy K√®o (B·∫°n l√† ch·ªß k√®o)',
                details_full: 'K√®o ƒë√£ ƒë·ªß ng∆∞·ªùi',
                details_icebreaker_button: '‚ú® G·ª£i √Ω c√¢u ch√†o h·ªèi (AI)',
                details_icebreaker_title: '‚ú® Th·ª≠ v√†i c√¢u h·ªèi ph√° bƒÉng (AI):',
                weather_forecast: 'D·ª± b√°o th·ªùi ti·∫øt',
                community_vouch: 'B·∫£o ch·ª©ng',
                coming_soon: 'T√≠nh nƒÉng s·∫Øp ra m·∫Øt!',
                gemini_error: 'ƒê√£ x·∫£y ra l·ªói, vui l√≤ng th·ª≠ l·∫°i.',
                gemini_prompt_title: 'Vui l√≤ng nh·∫≠p lo·∫°i k√®o ho·∫∑c ƒë·ªãa ƒëi·ªÉm ƒë·ªÉ AI g·ª£i √Ω.',
                profile_bio: 'Gi·ªõi thi·ªáu ng·∫Øn',
                profile_bio_suggest: '‚ú® G·ª£i √Ω Bio (AI)',
                challenge_suggest_btn: '‚ú® G·ª£i √Ω Th·ª≠ th√°ch Tu·∫ßn m·ªõi',
                challenge_idea_title: '√ù t∆∞·ªüng Th·ª≠ th√°ch:',
                
                // B·ªî SUNG KEY C√íN THI·∫æU
                participants_count_suffix: 'ng∆∞·ªùi',
            },
            en: {
                login_prompt: 'Login to start connecting!',
                login_email: 'Email',
                login_password: 'Password',
                login_terms: 'I agree to the ',
                login_terms_link: 'Terms',
                login_policy_link: 'Policy',
                login_button: 'Login',
                login_with: 'or log in with',
                login_signup_prompt: "Don't have an account? ",
                login_signup_link: 'Sign up now',
                signup_title: 'Create Account',
                signup_subtitle: 'Join the K√®o Th∆°m community!',
                signup_name: 'Full Name',
                signup_email: 'Email',
                signup_password: 'Password',
                signup_button: 'Sign Up',
                signup_login_prompt: 'Already have an account? ',
                signup_login_link: 'Log in',
                verify_title: 'Identity Verification',
                verify_subtitle: 'For community safety, please upload the front of your National ID.',
                verify_front: 'Click to upload photo',
                verify_button: 'Complete & Get Started',
                upload_status_uploaded: 'Uploaded ‚úì',
                tagline: 'Spontaneous Connections, Stronger Communities.',
                nav_home: 'Find Keos',
                nav_reels: 'Keo Reels',
                nav_marketplace: 'Marketplace',
                nav_coupons: 'Coupon Hub',
                nav_challenges: 'Challenges & Rankings',
                nav_qna: 'Quick Q&A',
                nav_sos: 'SOS Keo',
                nav_my_keos: 'My Keos',
                nav_notifications: 'Notifications',
                create_keo_button: 'Create New Keo',
                search_placeholder: 'Search for keos...',
                feed_title: 'Featured Keos Nearby',
                filter_all: 'All',
                filter_eating: 'üçî Eating',
                filter_sports: '‚öΩÔ∏è Sports',
                filter_study: 'üìö Study',
                filter_fun: 'üé¨ Fun',
                map_title: 'Keo Map',
                map_placeholder: 'Google Map (disabled)',
                details_prompt_title: 'Select a keo to see details',
                details_prompt_subtitle: 'Information about location, time, and participants will appear here.',
                modal_create_title: 'Create New Keo',
                modal_create_content: 'Keo content',
                modal_create_suggest: '‚ú® Suggest',
                modal_create_category: 'Keo type',
                category_eating: 'Eating',
                category_sports: 'Sports',
                category_study: 'Study',
                category_fun: 'Fun',
                modal_create_location: 'Location',
                modal_create_max_participants: 'Max participants (incl. you)',
                modal_cancel: 'Cancel',
                modal_create_publish: 'Post Keo',
                profile_university: 'Student - Vietnam National University, Hanoi',
                profile_tab_created: 'Created Keos',
                profile_tab_joined: 'Joined Keos',
                my_keos_created_title: 'Keos You Created',
                my_keos_joined_title: 'Keos You Joined',
                profile_no_created: 'No activities yet.',
                profile_no_joined: "You haven't joined any keos yet.",
                profile_logout: 'Logout',
                details_participants_title: 'Who will join',
                details_join_button: 'Join this Keo',
                details_leave_button: 'Leave Keo',
                details_cancel_button: 'Cancel Keo (You are creator)',
                details_full: 'Keo is full',
                details_icebreaker_button: '‚ú® Suggest Icebreakers (AI)',
                details_icebreaker_title: '‚ú® Try some icebreakers (AI):',
                weather_forecast: 'Weather Forecast',
                community_vouch: 'Vouch',
                coming_soon: 'Feature coming soon!',
                gemini_error: 'An error occurred, please try again.',
                gemini_prompt_title: 'Please enter a keo type or location for AI suggestions.',
                alert_fill_fields: 'Please fill in the content and location.',
                alert_fill_name: 'Please enter your name.',
                alert_fill_email: 'Please enter your email.',
                alert_cancel_keo_confirm: 'Are you sure you want to cancel this keo? This action cannot be undone.',
                my_keos_created_title: 'Keos You Created',
                my_keos_joined_title: 'Keos You Joined',
                profile_bio: 'Short Bio',
                profile_bio_suggest: '‚ú® Suggest Bio (AI)',
                challenge_suggest_btn: '‚ú® Suggest New Weekly Challenge',
                challenge_idea_title: 'Challenge Idea:',

                // B·ªî SUNG KEY C√íN THI·∫æU
                participants_count_suffix: 'people',
            }
        };
        
        // --- DOM Elements ---
        const authContainer = document.getElementById('auth-container');
        const loginScreen = document.getElementById('login-screen');
        const signupScreen = document.getElementById('signup-screen');
        const verificationScreen = document.getElementById('verification-screen');
        const mainApp = document.getElementById('main-app');
        
        const loginBtn = document.getElementById('login-btn');
        const loginEmailInput = document.getElementById('login-email');
        const loginPasswordInput = document.getElementById('login-password');
        const loginErrorMsg = document.getElementById('login-error-msg');
        
        const signupLink = document.getElementById('signup-link');
        const backToLoginLink = document.getElementById('back-to-login-link');
        
        const signupBtn = document.getElementById('signup-btn');
        const signupNameInput = document.getElementById('signup-name');
        const signupEmailInput = document.getElementById('signup-email');
        const signupPasswordInput = document.getElementById('signup-password');
        const signupErrorMsg = document.getElementById('signup-error-msg');

        const submitVerificationBtn = document.getElementById('submit-verification-btn');
        const cccdUploadInput = document.getElementById('cccd-upload');
        const uploadText = document.getElementById('upload-text');
        const termsCheckbox = document.getElementById('terms-checkbox');
        
        const keoFeed = document.getElementById('keo-feed');
        const filtersContainer = document.getElementById('filters');
        const keoDetailsContainer = document.getElementById('keo-details');
        
        const profileBtn = document.getElementById('profile-btn');
        const profileModal = document.getElementById('profile-modal');
        const logoutBtn = document.getElementById('logout-btn');
        const profileName = document.getElementById('profile-modal-name');
        const profileUniversity = document.getElementById('profile-modal-university');
        const profileAvatar = document.getElementById('profile-modal-avatar');
        const profileHeaderAvatar = document.getElementById('profile-header-avatar');
        const profileHeaderName = document.getElementById('profile-header-name');
        const createdKeosTab = document.getElementById('tab-content-created');
        const joinedKeosTab = document.getElementById('tab-content-joined');
        const achievementsTab = document.getElementById('tab-content-achievements');
        
        const geminiBioBtn = document.getElementById('gemini-bio-btn');
        const bioLoader = document.getElementById('bio-loader');
        const profileBioInput = document.getElementById('profile-bio-input');
        const geminiChallengeBtn = document.getElementById('gemini-challenge-btn');
        const challengeLoader = document.getElementById('challenge-loader');
        const challengeSuggestionBox = document.getElementById('challenge-suggestion-box');
        const challengeSuggestionText = document.getElementById('challenge-suggestion-text');
        
        const createKeoBtn = document.getElementById('create-keo-btn');
        const createKeoModal = document.getElementById('create-keo-modal');
        
        const geminiTitleBtn = document.getElementById('gemini-title-btn');
        const titleLoader = document.getElementById('title-loader');
        const titleSuggestionsContainer = document.getElementById('title-suggestions');
        const keoTitleInput = document.getElementById('keo-title-input');
        const keoCategoryInput = document.getElementById('keo-category-input');
        const keoLocationInput = document.getElementById('keo-location-input');
        const keoMaxInput = document.getElementById('keo-max-input');
        const publishKeoBtn = document.getElementById('publish-keo-btn');
        
        const sidebarLinks = document.querySelectorAll('.sidebar-link');
        const views = document.querySelectorAll('.view-content');
        
        let map = null; // Map object is now just a placeholder
        let markers = [];
        let activeMarker = null;
        let currentLang = 'vi';

        // --- Language Function ---
        function setLanguage(lang) {
            currentLang = lang;
            document.documentElement.lang = lang;
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.getAttribute('data-translate-key');
                if (translations[lang] && translations[lang][key]) {
                    if (key === 'login_terms') {
                        el.innerHTML = `${translations[lang][key]}<a href="#" class="font-medium text-teal-600 hover:underline">${translations[lang]['login_terms_link']}</a> ${lang === 'vi' ? 'v√†' : 'and'} <a href="#" class="font-medium text-teal-600 hover:underline">${translations[lang]['login_policy_link']}</a>`;
                    } else if (key === 'login_signup_prompt') {
                         el.innerHTML = `${translations[lang][key]}<a href="#" class="font-medium text-teal-600 hover:underline" data-dynamic-link="signup">${translations[lang]['login_signup_link']}</a>`;
                    } else if (key === 'signup_login_prompt') {
                         el.innerHTML = `${translations[lang][key]}<a href="#" class="font-medium text-teal-600 hover:underline" data-dynamic-link="login">${translations[lang]['signup_login_link']}</a>`;
                    } else {
                         el.textContent = translations[lang][key];
                    }
                }
            });
            
            attachDynamicAuthListeners();
            
            const searchInput = document.querySelector('input[data-translate-key="search_placeholder"]');
            if(searchInput) searchInput.placeholder = translations[lang].search_placeholder;
            
            document.getElementById('lang-vi').classList.toggle('active', lang === 'vi');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            
            if (currentUser) {
                profileUniversity.textContent = currentUser.university || (lang === 'vi' ? 'Sinh vi√™n - ƒê·∫°i h·ªçc Qu·ªëc gia H√† N·ªôi' : 'Student - Vietnam National University, Hanoi');
            }

            const currentFilterBtn = document.querySelector('.filter-btn.active');
            const currentFilter = currentFilterBtn ? currentFilterBtn.dataset.filter : 'all';
            if (document.getElementById('view-home') && document.getElementById('view-home').classList.contains('hidden') === false) {
                 renderKeos(currentFilter);
            }
            
            if(keoDetailsContainer) keoDetailsContainer.innerHTML = `<div class="text-center text-gray-500 pt-10"><p class="text-lg font-semibold">${translations[lang].details_prompt_title}</p><p class="text-sm">${translations[lang].details_prompt_subtitle}</p></div>`;
            
            if (createdKeosTab && userCreatedKeos.length === 0) createdKeosTab.querySelector('p').textContent = translations[lang].profile_no_created;
            if (joinedKeosTab && userJoinedKeos.length === 0) joinedKeosTab.querySelector('p').textContent = translations[lang].profile_no_joined;
            if (achievementsTab) achievementsTab.querySelector('p').textContent = translations[lang].coming_soon;
        }


        // --- Map Functions (Mock) ---
        function initMap() {
            console.log("Mock Map Initialized (Google Maps API is not loaded)");
            renderKeos('all');
        }
        window.initMap = initMap; // Make it globally accessible

        const highlightMarker = (marker) => {
             console.log("Highlighting marker:", marker.keoId);
             if (activeMarker) activeMarker.active = false;
             marker.active = true;
             activeMarker = marker;
        };

         const clearMarkers = () => {
            markers = [];
            activeMarker = null;
        }

        const addMarker = (keo) => {
            if (!keo.lat || !keo.lng) return;
            const marker = {
                position: { lat: keo.lat, lng: keo.lng },
                title: keo.title,
                keoId: keo.id,
                active: false
            };
            markers.push(marker);
            return marker;
        }

        // --- Gemini API Call (Mock) ---
        async function callGemini(prompt, retries = 3, delay = 1000) {
            console.log("Calling Gemini with prompt:", prompt);
            await new Promise(res => setTimeout(res, 500)); // Simulate network delay
            
            if (prompt.includes('G·ª£i √Ω 3 t√™n "k√®o"')) {
                return "K√®o si√™u t·ªëc: B√∫n ƒë·∫≠u M·∫πt\nC√† ph√™ chi·ªÅu, ai ƒëi?\nT√¨m ƒë·ªìng ƒë·ªôi h·ªçc Tri·∫øt qua ƒë√™m";
            }
            if (prompt.includes('Suggest 3 catchy')) {
                return "Speed K√®o: Bun Dau Met\nAfternoon Coffee Run, anyone?\nNeed Philosophy study buddies STAT";
            }
            if (prompt.includes('G·ª£i √Ω 3 c√¢u h·ªèi "ph√° bƒÉng"')) {
                return "M·ªçi ng∆∞·ªùi bi·∫øt qu√°n n√†y l√¢u ch∆∞a?\nNghe n√≥i k√®o n√†y... vui l·∫Øm ph·∫£i kh√¥ng?\nH·ªçc ng√†nh g√¨ th·∫ø c√°c b·∫°n ∆°i?";
            }
            if (prompt.includes('Suggest 3 natural, fun')) {
                return "First time at this place?\nHeard this 'keo' was fun, what do you guys think?\nWhat's everyone's major?";
            }
            if (prompt.includes('Vi·∫øt m·ªôt c√¢u gi·ªõi thi·ªáu (bio) ng·∫Øn')) {
                 return "Gen Z m√™ c·∫ßu l√¥ng, nghi·ªán c√† ph√™ v√† th√≠ch ch·ª•p ·∫£nh d·∫°o!";
            }
            if (prompt.includes('Write a short, fun, one-line profile bio')) {
                 return "Gen Z on a quest for good coffee and great stories. Loves badminton courts and photo walks!";
            }
            if (prompt.includes('G·ª£i √Ω m·ªôt th·ª≠ th√°ch c·ªông ƒë·ªìng')) {
                 return "Th·ª≠ th√°ch \"Foodie Tu·∫ßn\": Check-in t·∫°i 3 'K√®o ƒÇn u·ªëng' ·ªü 3 qu√°n kh√°c nhau trong 7 ng√†y!";
            }
            if (prompt.includes('Suggest a fun, hyperlocal weekly community challenge')) {
                 return "The \"Triple Threat\" Challenge: Join one 'Eating', one 'Sports', and one 'Study' Keo this week!";
            }
            return translations[currentLang].gemini_error;
        }
        
        const renderKeos = (filter = 'all') => {
            if (!keoFeed) return;
            keoFeed.innerHTML = '';
            clearMarkers();
            const translatedCategoryEating = translations[currentLang].category_eating;
            const translatedCategorySports = translations[currentLang].category_sports;
            const translatedCategoryStudy = translations[currentLang].category_study;
            const translatedCategoryFun = translations[currentLang].category_fun;

            // S·ª¨A L·ªñI: Di chuy·ªÉn kh·ªëi ƒë·ªãnh nghƒ©a 'filteredKeos' l√™n ƒê·∫¶U H√ÄM
            const filteredKeos = filter === 'all' ? DUMMY_KEOS : DUMMY_KEOS.filter(keo => {
                if (filter === 'ƒÇn u·ªëng' || filter === 'Eating') return keo.category === translatedCategoryEating || keo.category === translations['en'].category_eating;
                if (filter === 'Th·ªÉ thao' || filter === 'Sports') return keo.category === translatedCategorySports || keo.category === translations['en'].category_sports;
                if (filter === 'H·ªçc t·∫≠p' || filter === 'Study') return keo.category === translatedCategoryStudy || keo.category === translations['en'].category_study;
                if (filter === 'Gi·∫£i tr√≠' || filter === 'Fun') return keo.category === translatedCategoryFun || keo.category === translations['en'].category_fun;
                return false;
            });

            if (filteredKeos.length === 0) {
                keoFeed.innerHTML = `<p class="text-center text-gray-500">${translations[currentLang].no_keo_found}</p>`;
                return;
            }
            
            // Gi·ªù 'filteredKeos' ƒë√£ ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a v√† c√≥ th·ªÉ d√πng ·ªü ƒë√¢y
            filteredKeos.forEach(keo => {
                const keoCard = document.createElement('div');
                keoCard.className = 'bg-white p-4 rounded-lg border border-gray-200 cursor-pointer hover:border-teal-500 hover:shadow-md transition-all';
                keoCard.onclick = () => renderKeoDetails(keo); 
                const participantAvatars = keo.participants.slice(0, 3).map(p => `<div class="w-8 h-8 rounded-full bg-teal-100 text-teal-700 text-sm font-bold flex items-center justify-center border-2 border-white" title="${p}">${p.charAt(0)}</div>`).join('');
                const moreParticipants = keo.participants.length > 3 ? `<div class="w-8 h-8 rounded-full bg-gray-300 text-gray-700 text-sm font-bold flex items-center justify-center border-2 border-white">+${keo.participants.length - 3}</div>` : '';
                
                // S·ª¨A L·ªñI CH√çNH T·∫¢: "whitespace-noww rap" -> "whitespace-nowrap"
                keoCard.innerHTML = `<div class="flex items-start"><div class="w-12 h-12 rounded-lg bg-gray-100 flex items-center justify-center mr-4 text-2xl flex-shrink-0">${keo.avatar}</div><div class="flex-1 min-w-0"><p class="text-sm font-bold text-orange-600 truncate">${keo.category}</p><h3 class="font-bold text-lg leading-tight truncate" title="${keo.title}">${keo.title}</h3><p class="text-xs text-gray-500 mt-1 truncate" title="${keo.location}">${keo.location}</p></div><div class="text-right ml-2 flex-shrink-0"><p class="text-sm font-semibold text-teal-600 whitespace-nowrap">${keo.time}</p></div></div><div class="flex justify-between items-center mt-3 pt-3 border-t border-gray-100"><div class="flex -space-x-2 flex-shrink-0">${participantAvatars}${moreParticipants}</div><span class="text-sm font-bold ml-2 whitespace-nowrap">${keo.participants.length}/${keo.maxParticipants} ${translations[currentLang].participants_count_suffix}</span></div>`;
                keoFeed.appendChild(keoCard);
                addMarker(keo);
            });
            
            // X√ìA D√íNG G·ªåI H√ÄM B·ªä TH·ª™A N√ÄY
            // renderKeoList(filteredKeos, keoFeed, 'no_keo_found', false);
        };

        // --- Publish Keo Functionality ---
        publishKeoBtn.addEventListener('click', () => {
            if (!currentUser) { showLoginScreen(); return; }
            const title = keoTitleInput.value;
            const category = keoCategoryInput.value;
            const location = keoLocationInput.value;
            const maxP = parseInt(keoMaxInput.value) || 2;

            if (!title.trim() || !location.trim()) {
                alert(translations[currentLang].alert_fill_fields);
                return;
            }
            const categoryMap = { 'ƒÇn u·ªëng': 'üçî', 'Th·ªÉ thao': '‚öΩÔ∏è', 'H·ªçc t·∫≠p': 'üìö', 'Gi·∫£i tr√≠': 'üé¨', 'Eating': 'üçî', 'Sports': '‚öΩÔ∏è', 'Study': 'üìö', 'Fun': 'üé¨' };
            const newKeo = {
                id: 'keo-' + Date.now(),
                category: category,
                title: title,
                location: location,
                time: currentLang === 'vi' ? 'V·ª´a xong' : 'Just now',
                participants: [currentUser.name],
                maxParticipants: maxP,
                avatar: categoryMap[category] || 'üéâ',
                lat: 21.0278 + (Math.random() - 0.5) * 0.02, // Mock coords
                lng: 105.8342 + (Math.random() - 0.5) * 0.02, // Mock coords
                creator: currentUser.name
            };
            DUMMY_KEOS.unshift(newKeo);
            userCreatedKeos.unshift(newKeo);
            
            keoTitleInput.value = ''; keoLocationInput.value = ''; keoMaxInput.value = '5';
            titleSuggestionsContainer.innerHTML = '';
            closeModal(createKeoModal);
            
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.filter-btn[data-filter="all"]').classList.add('active');
            renderKeos('all');
            renderKeoDetails(newKeo);
        });
        
        // --- Render Profile Keo Lists ---
        function renderProfileKeoList(keos, container) {
            if (!container) return;
            if (keos.length === 0) {
                const noKeoKey = container.id.includes('created') ? 'profile_no_created' : 'profile_no_joined';
                container.innerHTML = `<p class="text-center text-gray-500">${translations[currentLang][noKeoKey]}</p>`;
                return;
            }
            container.innerHTML = keos.map(keo => `
                <div class="p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer" onclick="window.openKeoFromProfile('${keo.id}')">
                    <p class="font-semibold truncate">${keo.title}</p>
                    <p class="text-xs text-gray-500">${keo.location} - ${keo.time}</p>
                </div>`).join('');
        }
        
        window.openKeoFromProfile = (keoId) => {
            const keo = DUMMY_KEOS.find(k => k.id === keoId);
            if (keo) {
                closeModal(profileModal);
                document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                document.querySelector('.sidebar-link[data-view="home"]').classList.add('active');
                views.forEach(view => view.id === 'view-home' ? view.classList.remove('hidden') : view.classList.add('hidden'));
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('.filter-btn[data-filter="all"]').classList.add('active');
                renderKeos('all');
                renderKeoDetails(keo);
            }
        }
        
        // --- Render My Keos Page ---
        function renderMyKeosPage() {
            const createdListContainer = document.getElementById('my-created-keos-list');
            const joinedListContainer = document.getElementById('my-joined-keos-list');
            
            renderKeoList(userCreatedKeos, createdListContainer, 'profile_no_created', true);
            renderKeoList(userJoinedKeos, joinedListContainer, 'profile_no_joined', false);
            
            const firstTab = document.querySelector('.my-keos-tab[data-tab="my-created"]');
            if (firstTab) firstTab.classList.add('active');
            const secondTab = document.querySelector('.my-keos-tab[data-tab="my-joined"]');
            if (secondTab) secondTab.classList.remove('active');
            
            if(createdListContainer) createdListContainer.classList.remove('hidden');
            if(joinedListContainer) joinedListContainer.classList.add('hidden');
        }

        // --- Auth Flow Logic ---
        function showScreen(screenToShow) {
            [loginScreen, signupScreen, verificationScreen].forEach(screen => {
                if (screen === screenToShow) {
                    screen.classList.remove('hidden');
                } else {
                    screen.classList.add('hidden');
                }
            });
            if (screenToShow) {
                authContainer.classList.remove('hidden');
                mainApp.classList.add('hidden');
            } else {
                authContainer.classList.add('hidden');
                mainApp.classList.remove('hidden');
            }
        }

        function showLoginScreen(e) { if(e) e.preventDefault(); showScreen(loginScreen); }
        function showSignupScreen(e) { if(e) e.preventDefault(); showScreen(signupScreen); }

        // MOCK Auth Handlers (Kh√¥ng d√πng Firebase)
        function handleSignup(e) {
            e.preventDefault();
            const name = signupNameInput.value;
            const email = signupEmailInput.value;
            if (!name.trim()) { 
                signupErrorMsg.textContent = translations[currentLang].alert_fill_name; 
                signupErrorMsg.style.display = 'block';
                return;
            }
            if (!email.trim()) { 
                signupErrorMsg.textContent = translations[currentLang].alert_fill_email;
                signupErrorMsg.style.display = 'block';
                return;
            }
            currentUser = { name: name, email: email, avatarInitial: name.split(' ').map(n=>n[0]).join('').substring(0,2).toUpperCase() || 'KT', university: translations[currentLang].profile_university };
            signupErrorMsg.style.display = 'none';
            showScreen(verificationScreen);
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = loginEmailInput.value;
            if (!email.trim()) {
                 loginErrorMsg.textContent = translations[currentLang].alert_fill_email;
                 loginErrorMsg.style.display = 'block';
                 return;
            }
            const name = email.split('@')[0];
            const avatarInitial = name.charAt(0).toUpperCase() || 'KT';
            currentUser = { name: name, email: email, avatarInitial: avatarInitial, university: translations[currentLang].profile_university };
            loginErrorMsg.style.display = 'none';
            showScreen(null); // Show main app
            setLanguage(currentLang);
            profileHeaderName.textContent = currentUser.name;
            profileHeaderAvatar.src = `https://placehold.co/100x100/A7F3D0/134E4A?text=${currentUser.avatarInitial}`;
        }

        function handleLogout() {
            currentUser = null;
            showScreen(loginScreen); // Show login
            termsCheckbox.checked = false;
            loginBtn.disabled = true;
            userCreatedKeos = [];
            userJoinedKeos = [];
            keoDetailsContainer.innerHTML = `<div class="text-center text-gray-500 pt-10"><p class="text-lg font-semibold">${translations[currentLang].details_prompt_title}</p><p class="text-sm">${translations[currentLang].details_prompt_subtitle}</p></div>`;
            uploadText.textContent = translations[currentLang].verify_front;
            uploadText.classList.remove('text-teal-600', 'font-bold');
            submitVerificationBtn.disabled = true;
            if(cccdUploadInput) cccdUploadInput.value = '';
            
            // Reset to home view when logging out
            document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
            document.querySelector('.sidebar-link[data-view="home"]').classList.add('active');
            views.forEach(view => view.id === 'view-home' ? view.classList.remove('hidden') : view.classList.add('hidden'));
        }

        // --- Attach Listeners ---
        function attachDynamicAuthListeners() {
            const signupLinkDynamic = document.querySelector('[data-dynamic-link="signup"]');
            const backToLoginLinkDynamic = document.querySelector('[data-dynamic-link="login"]');
            if(signupLinkDynamic) signupLinkDynamic.addEventListener('click', showSignupScreen);
            if(backToLoginLinkDynamic) backToLoginLinkDynamic.addEventListener('click', showLoginScreen);
        }

        authContainer.addEventListener('click', (e) => {
            if (e.target.id === 'login-btn') handleLogin(e);
            if (e.target.id === 'signup-link' || e.target.dataset.dynamicLink === 'signup') showSignupScreen(e);
            if (e.target.id === 'signup-btn') handleSignup(e);
            if (e.target.id === 'back-to-login-link' || e.target.dataset.dynamicLink === 'login') showLoginScreen(e);
            if (e.target.id === 'submit-verification-btn') {
                showScreen(null); // V√†o app
                setLanguage(currentLang);
                profileHeaderName.textContent = currentUser.name;
                profileHeaderAvatar.src = `https://placehold.co/100x100/A7F3D0/134E4A?text=${currentUser.avatarInitial}`;
            }
        });

        authContainer.addEventListener('change', (e) => {
            if (e.target.id === 'terms-checkbox') {
                loginBtn.disabled = !e.target.checked;
            }
            if (e.target.id === 'cccd-upload') {
                if (e.target.files && e.target.files.length > 0) {
                    uploadText.textContent = translations[currentLang].upload_status_uploaded;
                    uploadText.classList.add('text-teal-600', 'font-bold');
                    submitVerificationBtn.disabled = false;
                } else {
                     uploadText.textContent = translations[currentLang].verify_front;
                     uploadText.classList.remove('text-teal-600', 'font-bold');
                     submitVerificationBtn.disabled = true;
                }
            }
        });

        document.getElementById('lang-vi').addEventListener('click', () => setLanguage('vi'));
        document.getElementById('lang-en').addEventListener('click', () => setLanguage('en'));

        // Modal Logic
        const openModal = (modal) => modal.classList.remove('hidden');
        const closeModal = (modal) => modal.classList.add('hidden');

        createKeoBtn.addEventListener('click', () => openModal(createKeoModal));
            profileBtn.addEventListener('click', () => {
            if (!currentUser) return;
            
            profileName.textContent = currentUser.name;
            profileAvatar.src = `https://placehold.co/100x100/A7F3D0/134E4A?text=${currentUser.avatarInitial}`;
            profileUniversity.textContent = currentUser.university || (currentLang === 'vi' ? 'Tr∆∞·ªùng ƒê·∫°i h·ªçc...' : 'University...');
            
            profileBioInput.value = ''; 

            renderProfileKeoList(userCreatedKeos, createdKeosTab);
            renderProfileKeoList(userJoinedKeos, joinedKeosTab);
            
            document.querySelectorAll('.profile-tab').forEach(t=>t.classList.remove('active'));
            document.querySelector('.profile-tab[data-tab="created"]').classList.add('active');
            createdKeosTab.classList.remove('hidden');
            joinedKeosTab.classList.add('hidden');
            achievementsTab.classList.add('hidden');

            openModal(profileModal);
        });
        logoutBtn.addEventListener('click', handleLogout);
        
        document.querySelectorAll('.close-modal-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = e.target.closest('.fixed[id$="-modal"]');
                if (modal) closeModal(modal);
            });
        });

        document.querySelectorAll('#modals-container > .fixed, #auth-container > .fixed').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    if (!modal.id.includes('-screen')) {
                        closeModal(modal);
                    }
                }
            });
        });
        
        // Profile Tabs Logic
        const profileTabs = document.querySelectorAll('.profile-tab');
        const tabContents = { created: createdKeosTab, joined: joinedKeosTab, achievements: achievementsTab };
        profileTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                profileTabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                Object.values(tabContents).forEach(c => c.classList.add('hidden'));
                if(tabContents[tab.dataset.tab]) {
                    tabContents[tab.dataset.tab].classList.remove('hidden');
                }
                
                if(tab.dataset.tab === 'created') renderProfileKeoList(userCreatedKeos, createdKeosTab);
                if(tab.dataset.tab === 'joined') renderProfileKeoList(userJoinedKeos, joinedKeosTab);
            });
        });
        
        // --- Switch View Logic ---
        sidebarLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetViewId = link.dataset.view;
                if (!targetViewId) return;

                sidebarLinks.forEach(l => l.classList.remove('active'));
                link.classList.add('active');

                views.forEach(view => {
                    if (view.id === `view-${targetViewId}`) {
                        view.classList.remove('hidden');
                        if (targetViewId === 'home') {
                             renderKeos(document.querySelector('#view-home .filter-btn.active')?.dataset.filter || 'all');
                        }
                        if (targetViewId === 'mykeos') {
                             renderMyKeosPage(); // Render My Keos view
                        }
                    } else {
                        view.classList.add('hidden');
                    }
                });
                
                // T·∫Øt c·ªôt b√™n ph·∫£i (B·∫£n ƒë·ªì & Chi ti·∫øt) n·∫øu kh√¥ng ph·∫£i l√† trang ch·ªß
                const homeAside = document.querySelector('#view-home aside');
                if (homeAside) {
                    if (targetViewId !== 'home') {
                        homeAside.classList.add('hidden'); // ·∫®n c·ªôt b√™n ph·∫£i
                    } else {
                        homeAside.classList.remove('hidden'); // Hi·ªán l·∫°i c·ªôt b√™n ph·∫£i
                    }
                }
                
                if (targetViewId !== 'home') {
                    if(keoDetailsContainer) keoDetailsContainer.innerHTML = `<div class="text-center text-gray-500 pt-10"><p class="text-lg font-semibold">${translations[currentLang].details_prompt_title}</p><p class="text-sm">${translations[currentLang].details_prompt_subtitle}</p></div>`;
                     if(activeMarker) activeMarker.setAnimation(null); activeMarker = null;
                }
            });
        });

        // --- "My Keos" Page Tab Logic ---
        document.querySelector('#view-mykeos').addEventListener('click', (e) => {
             // X·ª≠ l√Ω chuy·ªÉn tab
             if (e.target.classList.contains('my-keos-tab')) {
                 document.querySelectorAll('.my-keos-tab').forEach(t => t.classList.remove('active'));
                 e.target.classList.add('active');
                 
                 const tabContentId = e.target.dataset.tab; // "my-created" or "my-joined"
                 document.querySelectorAll('.my-keos-tab-content').forEach(c => {
                     if (c.id === `${tabContentId}-keos-list`) {
                         c.classList.remove('hidden');
                     } else {
                         c.classList.add('hidden');
                     }
                 });
             }
             
             // X·ª≠ l√Ω n√∫t H·ªßy K√®o (Event Delegation)
             if (e.target.classList.contains('my-keos-cancel-btn')) {
                 const keoId = e.target.dataset.cancelId;
                 handleCancelKeo(keoId);
             }
        });


        // --- Initial State ---
        setLanguage('vi'); // Set default language
        showScreen(loginScreen); // Show login screen by default
        initMap(); // Call mock map init
    
    }); // K·∫æT TH√öC DOMCONTENTLOADED
</script>
<!-- ƒê√£ x√≥a script Google Maps API -->
</body>
</html>
